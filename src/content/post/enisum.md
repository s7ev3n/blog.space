---
title: "Einsum"
description: "einsum"
publishDate: "3 Jan 2025"
tags: ["tech/gems"]
---

> einsum，又称为爱因斯坦求和约定，是爱因斯坦在张量运算中引入的一种简化符号规则，用于省略求和符号($\sum$)。看到求和标记，经常会一脸懵逼不知道在做什么。


## `einsum`规则

## `einsum`的等价形式

### 向量
设`A`和`B`是一维向量：
| 标记符号            | `Numpy`等价形式 | 描述                     |
|:--------------------|:---------------|:-------------------------|
| `('i', A)`          | `A`              | 向量`A`本身               |
| `('i->', A)`        | `sum(A)`         | 向量`A`所有元素求和       |
| `('i,i->i', A, B)`  | `A * B`          | 向量`A`和向量`B`逐元素相乘 |
| `('i,i', A, B)`     | `inner(A, B)`    | 向量`A`和向量`B`的内积   |
| `('i,j->ij', A, B)` | `outer(A, B)`    | 向量`A`和向量`B`的外积   |

### 二维矩阵
以下是转换为 Markdown 表格的内容：

| 标记符号                | `Numpy`等价形式                | 描述                                 |
|:-----------------------|:--------------------------------|:-------------------------------------|
| `('ij', A)`            | `A`                             | 矩阵 A 本身                           |
| `('ji', A)`            | `A.T`                           | 矩阵 A 转置                           |
| `('ii->i', A)`         | `diag(A)`                       | 矩阵 A 对角元素                       |
| `('ii', A)`            | `trace(A)`                      | 矩阵 A 的 迹（主对角线之和）           |
| `('ij->', A)`          | `sum(A)`                        | 矩阵 A 所有元素求和                   |
| `('ij->j', A)`         | `sum(A, axis=0)`                | 矩阵 A 列求和，保留列（axis=1），对轴（axis=0）求和 |
| `('ij->i', A)`         | `sum(A, axis=1)`                | 矩阵 A 行求和，保留行（axis=0），对轴（axis=1）求和 |
| `('ij,ij->ij', A, B)`  | `A * B`                         | A 和 B 哈达玛积（逐元素相乘）           |
| `('ij,ji->ij', A, B)`  | `A * B.T`                       | A 和 B 的转置逐元素相乘               |
| `('ij,jk', A, B)`      | `dot(A, B)`                     | A 和 B 的矩阵乘法                     |
| `('ij,kj->ik', A, B)`  | `inner(A, B)`                   | 矩阵 A 和 矩阵 B 的内积               |
| `('ij,kj->ikj', A, B)` | `A[:, None] * B`                |                                      |
| `('ij,kl->ijkl', A, B)`| `A[:, :, None, None] * B`       |                                      |